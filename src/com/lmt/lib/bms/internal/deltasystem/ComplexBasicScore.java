package com.lmt.lib.bms.internal.deltasystem;

import com.lmt.lib.bms.bemusic.BeMusicDevice;

/**
 * 譜面傾向「COMPLEX」の基本評価点クラス
 */
class ComplexBasicScore {
	/** 基本評価点テーブルに要求する配列要素数 */
	private static final int REQUIRE_TABLE_SIZE = 255;

	/** インスタンス */
	private static ComplexBasicScore sInstance = null;

	/** 入力デバイステーブル */
	private BeMusicDevice[] mDevices;
	/** 基本評価点テーブル */
	private double[] mScores;

	/**
	 * インスタンス取得
	 * @return インスタンス
	 */
	static ComplexBasicScore getInstance() {
		if (sInstance == null) {
			sInstance = new ComplexBasicScore();
		}
		return sInstance;
	}

	/**
	 * 基本評価点取得
	 * @param elem COMPLEXの分析データ
	 * @return 基本評価点
	 */
	final double get(ComplexElement elem) {
		return mScores[index(elem)];
	}

	/**
	 * 基本評価点テーブルのインデックス値計算
	 * @param elem COMPLEXの分析データ
	 * @return 基本評価点テーブルのインデックス値
	 */
	private int index(ComplexElement elem) {
		var result = 0;
		var count = mDevices.length;
		for (var i = 0; i < count; i++) {
			result += elem.getNoteType(mDevices[i]).hasVisualEffect() ? (1 << i) : 0;
		}
		return result;
	}

	/**
	 * コンストラクタ
	 */
	private ComplexBasicScore() {
		// 定義ミスを避けるためにスコアテーブルのサイズをチェックする
		// ここで例外がスローされる場合スコアテーブルの定義ミスが確定している
		var actualLength = SCORE_TABLE.length;
		if (actualLength != REQUIRE_TABLE_SIZE) {
			var msg = String.format("SCORE_TABLE size must be %d, but %d.", REQUIRE_TABLE_SIZE, actualLength);
			throw new RuntimeException(msg);
		}

		// スコア定義をコピーする
		// ノートなしは0点なので、テーブルの先頭には0をセットしておく
		mScores = new double[REQUIRE_TABLE_SIZE + 1];
		mScores[0] = 0.0;
		for (var i = 0; i < REQUIRE_TABLE_SIZE; i++) {
			mScores[i + 1] = SCORE_TABLE[i];
		}

		// その他の初期化処理
		mDevices = BeMusicDevice.orderedBySpLeftList().toArray(BeMusicDevice[]::new);
	}

	/**
	 * 基本評価点テーブルの定義情報
	 * <p>このテーブルには「ComplexBasicScore.xlsx」の定義内容から生成されたコードをコピーすること。</p>
	 */
	private static final double[] SCORE_TABLE = {
			1.47,  // 0x01: |====|  |  |  |  |  |  |  |
			1.48,  // 0x02: |    |==|  |  |  |  |  |  |
			2.07,  // 0x03: |====|==|  |  |  |  |  |  |
			1.49,  // 0x04: |    |  |==|  |  |  |  |  |
			2.17,  // 0x05: |====|  |==|  |  |  |  |  |
			1.53,  // 0x06: |    |==|==|  |  |  |  |  |
			2.63,  // 0x07: |====|==|==|  |  |  |  |  |
			1.50,  // 0x08: |    |  |  |==|  |  |  |  |
			2.20,  // 0x09: |====|  |  |==|  |  |  |  |
			1.73,  // 0x0a: |    |==|  |==|  |  |  |  |
			2.65,  // 0x0b: |====|==|  |==|  |  |  |  |
			1.56,  // 0x0c: |    |  |==|==|  |  |  |  |
			2.77,  // 0x0d: |====|  |==|==|  |  |  |  |
			1.97,  // 0x0e: |    |==|==|==|  |  |  |  |
			3.05,  // 0x0f: |====|==|==|==|  |  |  |  |
			1.51,  // 0x10: |    |  |  |  |==|  |  |  |
			2.19,  // 0x11: |====|  |  |  |==|  |  |  |
			2.36,  // 0x12: |    |==|  |  |==|  |  |  |
			2.90,  // 0x13: |====|==|  |  |==|  |  |  |
			1.80,  // 0x14: |    |  |==|  |==|  |  |  |
			2.51,  // 0x15: |====|  |==|  |==|  |  |  |
			2.36,  // 0x16: |    |==|==|  |==|  |  |  |
			3.31,  // 0x17: |====|==|==|  |==|  |  |  |
			1.58,  // 0x18: |    |  |  |==|==|  |  |  |
			2.65,  // 0x19: |====|  |  |==|==|  |  |  |
			2.35,  // 0x1a: |    |==|  |==|==|  |  |  |
			3.51,  // 0x1b: |====|==|  |==|==|  |  |  |
			1.99,  // 0x1c: |    |  |==|==|==|  |  |  |
			3.13,  // 0x1d: |====|  |==|==|==|  |  |  |
			2.60,  // 0x1e: |    |==|==|==|==|  |  |  |
			3.72,  // 0x1f: |====|==|==|==|==|  |  |  |
			1.50,  // 0x20: |    |  |  |  |  |==|  |  |
			2.11,  // 0x21: |====|  |  |  |  |==|  |  |
			1.90,  // 0x22: |    |==|  |  |  |==|  |  |
			2.85,  // 0x23: |====|==|  |  |  |==|  |  |
			2.41,  // 0x24: |    |  |==|  |  |==|  |  |
			2.89,  // 0x25: |====|  |==|  |  |==|  |  |
			2.95,  // 0x26: |    |==|==|  |  |==|  |  |
			3.26,  // 0x27: |====|==|==|  |  |==|  |  |
			1.78,  // 0x28: |    |  |  |==|  |==|  |  |
			2.50,  // 0x29: |====|  |  |==|  |==|  |  |
			2.16,  // 0x2a: |    |==|  |==|  |==|  |  |
			3.18,  // 0x2b: |====|==|  |==|  |==|  |  |
			2.62,  // 0x2c: |    |  |==|==|  |==|  |  |
			3.48,  // 0x2d: |====|  |==|==|  |==|  |  |
			3.15,  // 0x2e: |    |==|==|==|  |==|  |  |
			3.82,  // 0x2f: |====|==|==|==|  |==|  |  |
			1.60,  // 0x30: |    |  |  |  |==|==|  |  |
			2.78,  // 0x31: |====|  |  |  |==|==|  |  |
			2.94,  // 0x32: |    |==|  |  |==|==|  |  |
			3.46,  // 0x33: |====|==|  |  |==|==|  |  |
			2.49,  // 0x34: |    |  |==|  |==|==|  |  |
			3.21,  // 0x35: |====|  |==|  |==|==|  |  |
			3.65,  // 0x36: |    |==|==|  |==|==|  |  |
			4.02,  // 0x37: |====|==|==|  |==|==|  |  |
			2.00,  // 0x38: |    |  |  |==|==|==|  |  |
			3.25,  // 0x39: |====|  |  |==|==|==|  |  |
			3.40,  // 0x3a: |    |==|  |==|==|==|  |  |
			4.22,  // 0x3b: |====|==|  |==|==|==|  |  |
			2.65,  // 0x3c: |    |  |==|==|==|==|  |  |
			4.07,  // 0x3d: |====|  |==|==|==|==|  |  |
			3.10,  // 0x3e: |    |==|==|==|==|==|  |  |
			5.95,  // 0x3f: |====|==|==|==|==|==|  |  |
			1.49,  // 0x40: |    |  |  |  |  |  |==|  |
			2.12,  // 0x41: |====|  |  |  |  |  |==|  |
			2.55,  // 0x42: |    |==|  |  |  |  |==|  |
			2.65,  // 0x43: |====|==|  |  |  |  |==|  |
			1.92,  // 0x44: |    |  |==|  |  |  |==|  |
			2.54,  // 0x45: |====|  |==|  |  |  |==|  |
			2.51,  // 0x46: |    |==|==|  |  |  |==|  |
			3.16,  // 0x47: |====|==|==|  |  |  |==|  |
			2.40,  // 0x48: |    |  |  |==|  |  |==|  |
			2.97,  // 0x49: |====|  |  |==|  |  |==|  |
			2.38,  // 0x4a: |    |==|  |==|  |  |==|  |
			3.26,  // 0x4b: |====|==|  |==|  |  |==|  |
			3.28,  // 0x4c: |    |  |==|==|  |  |==|  |
			3.26,  // 0x4d: |====|  |==|==|  |  |==|  |
			3.29,  // 0x4e: |    |==|==|==|  |  |==|  |
			3.87,  // 0x4f: |====|==|==|==|  |  |==|  |
			1.79,  // 0x50: |    |  |  |  |==|  |==|  |
			2.55,  // 0x51: |====|  |  |  |==|  |==|  |
			2.41,  // 0x52: |    |==|  |  |==|  |==|  |
			3.06,  // 0x53: |====|==|  |  |==|  |==|  |
			2.18,  // 0x54: |    |  |==|  |==|  |==|  |
			3.12,  // 0x55: |====|  |==|  |==|  |==|  |
			3.58,  // 0x56: |    |==|==|  |==|  |==|  |
			4.13,  // 0x57: |====|==|==|  |==|  |==|  |
			2.43,  // 0x58: |    |  |  |==|==|  |==|  |
			3.31,  // 0x59: |====|  |  |==|==|  |==|  |
			3.49,  // 0x5a: |    |==|  |==|==|  |==|  |
			4.33,  // 0x5b: |====|==|  |==|==|  |==|  |
			3.44,  // 0x5c: |    |  |==|==|==|  |==|  |
			4.64,  // 0x5d: |====|  |==|==|==|  |==|  |
			4.46,  // 0x5e: |    |==|==|==|==|  |==|  |
			6.48,  // 0x5f: |====|==|==|==|==|  |==|  |
			1.55,  // 0x60: |    |  |  |  |  |==|==|  |
			2.65,  // 0x61: |====|  |  |  |  |==|==|  |
			2.50,  // 0x62: |    |==|  |  |  |==|==|  |
			3.46,  // 0x63: |====|==|  |  |  |==|==|  |
			3.27,  // 0x64: |    |  |==|  |  |==|==|  |
			3.76,  // 0x65: |====|  |==|  |  |==|==|  |
			3.70,  // 0x66: |    |==|==|  |  |==|==|  |
			4.17,  // 0x67: |====|==|==|  |  |==|==|  |
			2.59,  // 0x68: |    |  |  |==|  |==|==|  |
			3.59,  // 0x69: |====|  |  |==|  |==|==|  |
			3.54,  // 0x6a: |    |==|  |==|  |==|==|  |
			4.23,  // 0x6b: |====|==|  |==|  |==|==|  |
			4.00,  // 0x6c: |    |  |==|==|  |==|==|  |
			4.74,  // 0x6d: |====|  |==|==|  |==|==|  |
			3.71,  // 0x6e: |    |==|==|==|  |==|==|  |
			5.05,  // 0x6f: |====|==|==|==|  |==|==|  |
			1.98,  // 0x70: |    |  |  |  |==|==|==|  |
			3.20,  // 0x71: |====|  |  |  |==|==|==|  |
			3.41,  // 0x72: |    |==|  |  |==|==|==|  |
			4.17,  // 0x73: |====|==|  |  |==|==|==|  |
			3.35,  // 0x74: |    |  |==|  |==|==|==|  |
			4.24,  // 0x75: |====|  |==|  |==|==|==|  |
			4.06,  // 0x76: |    |==|==|  |==|==|==|  |
			5.18,  // 0x77: |====|==|==|  |==|==|==|  |
			2.57,  // 0x78: |    |  |  |==|==|==|==|  |
			4.17,  // 0x79: |====|  |  |==|==|==|==|  |
			4.56,  // 0x7a: |    |==|  |==|==|==|==|  |
			6.98,  // 0x7b: |====|==|  |==|==|==|==|  |
			3.15,  // 0x7c: |    |  |==|==|==|==|==|  |
			6.08,  // 0x7d: |====|  |==|==|==|==|==|  |
			4.95,  // 0x7e: |    |==|==|==|==|==|==|  |
			6.90,  // 0x7f: |====|==|==|==|==|==|==|  |
			1.47,  // 0x80: |    |  |  |  |  |  |  |==|
			2.05,  // 0x81: |====|  |  |  |  |  |  |==|
			1.99,  // 0x82: |    |==|  |  |  |  |  |==|
			2.55,  // 0x83: |====|==|  |  |  |  |  |==|
			2.58,  // 0x84: |    |  |==|  |  |  |  |==|
			2.65,  // 0x85: |====|  |==|  |  |  |  |==|
			2.86,  // 0x86: |    |==|==|  |  |  |  |==|
			3.09,  // 0x87: |====|==|==|  |  |  |  |==|
			1.88,  // 0x88: |    |  |  |==|  |  |  |==|
			2.51,  // 0x89: |====|  |  |==|  |  |  |==|
			2.40,  // 0x8a: |    |==|  |==|  |  |  |==|
			3.26,  // 0x8b: |====|==|  |==|  |  |  |==|
			2.55,  // 0x8c: |    |  |==|==|  |  |  |==|
			3.30,  // 0x8d: |====|  |==|==|  |  |  |==|
			3.25,  // 0x8e: |    |==|==|==|  |  |  |==|
			3.91,  // 0x8f: |====|==|==|==|  |  |  |==|
			2.35,  // 0x90: |    |  |  |  |==|  |  |==|
			2.65,  // 0x91: |====|  |  |  |==|  |  |==|
			3.35,  // 0x92: |    |==|  |  |==|  |  |==|
			3.56,  // 0x93: |====|==|  |  |==|  |  |==|
			2.40,  // 0x94: |    |  |==|  |==|  |  |==|
			3.51,  // 0x95: |====|  |==|  |==|  |  |==|
			3.81,  // 0x96: |    |==|==|  |==|  |  |==|
			4.22,  // 0x97: |====|==|==|  |==|  |  |==|
			3.03,  // 0x98: |    |  |  |==|==|  |  |==|
			3.56,  // 0x99: |====|  |  |==|==|  |  |==|
			3.77,  // 0x9a: |    |==|  |==|==|  |  |==|
			4.72,  // 0x9b: |====|==|  |==|==|  |  |==|
			3.65,  // 0x9c: |    |  |==|==|==|  |  |==|
			4.77,  // 0x9d: |====|  |==|==|==|  |  |==|
			4.90,  // 0x9e: |    |==|==|==|==|  |  |==|
			6.85,  // 0x9f: |====|==|==|==|==|  |  |==|
			1.73,  // 0xa0: |    |  |  |  |  |==|  |==|
			2.45,  // 0xa1: |====|  |  |  |  |==|  |==|
			2.33,  // 0xa2: |    |==|  |  |  |==|  |==|
			3.22,  // 0xa3: |====|==|  |  |  |==|  |==|
			2.35,  // 0xa4: |    |  |==|  |  |==|  |==|
			3.28,  // 0xa5: |====|  |==|  |  |==|  |==|
			3.37,  // 0xa6: |    |==|==|  |  |==|  |==|
			4.22,  // 0xa7: |====|==|==|  |  |==|  |==|
			2.13,  // 0xa8: |    |  |  |==|  |==|  |==|
			3.16,  // 0xa9: |====|  |  |==|  |==|  |==|
			2.70,  // 0xaa: |    |==|  |==|  |==|  |==|
			3.63,  // 0xab: |====|==|  |==|  |==|  |==|
			3.50,  // 0xac: |    |  |==|==|  |==|  |==|
			4.53,  // 0xad: |====|  |==|==|  |==|  |==|
			4.41,  // 0xae: |    |==|==|==|  |==|  |==|
			6.58,  // 0xaf: |====|==|==|==|  |==|  |==|
			2.34,  // 0xb0: |    |  |  |  |==|==|  |==|
			3.25,  // 0xb1: |====|  |  |  |==|==|  |==|
			3.79,  // 0xb2: |    |==|  |  |==|==|  |==|
			4.62,  // 0xb3: |====|==|  |  |==|==|  |==|
			3.52,  // 0xb4: |    |  |==|  |==|==|  |==|
			4.63,  // 0xb5: |====|  |==|  |==|==|  |==|
			4.76,  // 0xb6: |    |==|==|  |==|==|  |==|
			6.68,  // 0xb7: |====|==|==|  |==|==|  |==|
			3.48,  // 0xb8: |    |  |  |==|==|==|  |==|
			4.72,  // 0xb9: |====|  |  |==|==|==|  |==|
			4.96,  // 0xba: |    |==|  |==|==|==|  |==|
			6.78,  // 0xbb: |====|==|  |==|==|==|  |==|
			4.65,  // 0xbc: |    |  |==|==|==|==|  |==|
			6.58,  // 0xbd: |====|  |==|==|==|==|  |==|
			6.10,  // 0xbe: |    |==|==|==|==|==|  |==|
			6.70,  // 0xbf: |====|==|==|==|==|==|  |==|
			1.52,  // 0xc0: |    |  |  |  |  |  |==|==|
			2.67,  // 0xc1: |====|  |  |  |  |  |==|==|
			2.85,  // 0xc2: |    |==|  |  |  |  |==|==|
			3.25,  // 0xc3: |====|==|  |  |  |  |==|==|
			2.48,  // 0xc4: |    |  |==|  |  |  |==|==|
			3.09,  // 0xc5: |====|  |==|  |  |  |==|==|
			3.30,  // 0xc6: |    |==|==|  |  |  |==|==|
			4.02,  // 0xc7: |====|==|==|  |  |  |==|==|
			2.91,  // 0xc8: |    |  |  |==|  |  |==|==|
			3.30,  // 0xc9: |====|  |  |==|  |  |==|==|
			3.59,  // 0xca: |    |==|  |==|  |  |==|==|
			4.62,  // 0xcb: |====|==|  |==|  |  |==|==|
			3.83,  // 0xcc: |    |  |==|==|  |  |==|==|
			4.67,  // 0xcd: |====|  |==|==|  |  |==|==|
			3.60,  // 0xce: |    |==|==|==|  |  |==|==|
			6.08,  // 0xcf: |====|==|==|==|  |  |==|==|
			2.33,  // 0xd0: |    |  |  |  |==|  |==|==|
			3.24,  // 0xd1: |====|  |  |  |==|  |==|==|
			3.57,  // 0xd2: |    |==|  |  |==|  |==|==|
			4.52,  // 0xd3: |====|==|  |  |==|  |==|==|
			3.55,  // 0xd4: |    |  |==|  |==|  |==|==|
			4.43,  // 0xd5: |====|  |==|  |==|  |==|==|
			4.46,  // 0xd6: |    |==|==|  |==|  |==|==|
			5.98,  // 0xd7: |====|==|==|  |==|  |==|==|
			3.63,  // 0xd8: |    |  |  |==|==|  |==|==|
			4.52,  // 0xd9: |====|  |  |==|==|  |==|==|
			4.56,  // 0xda: |    |==|  |==|==|  |==|==|
			6.38,  // 0xdb: |====|==|  |==|==|  |==|==|
			4.75,  // 0xdc: |    |  |==|==|==|  |==|==|
			6.58,  // 0xdd: |====|  |==|==|==|  |==|==|
			5.80,  // 0xde: |    |==|==|==|==|  |==|==|
			6.80,  // 0xdf: |====|==|==|==|==|  |==|==|
			1.96,  // 0xe0: |    |  |  |  |  |==|==|==|
			3.10,  // 0xe1: |====|  |  |  |  |==|==|==|
			3.15,  // 0xe2: |    |==|  |  |  |==|==|==|
			4.02,  // 0xe3: |====|==|  |  |  |==|==|==|
			3.20,  // 0xe4: |    |  |==|  |  |==|==|==|
			4.27,  // 0xe5: |====|  |==|  |  |==|==|==|
			3.70,  // 0xe6: |    |==|==|  |  |==|==|==|
			6.05,  // 0xe7: |====|==|==|  |  |==|==|==|
			3.05,  // 0xe8: |    |  |  |==|  |==|==|==|
			4.42,  // 0xe9: |====|  |  |==|  |==|==|==|
			4.16,  // 0xea: |    |==|  |==|  |==|==|==|
			6.28,  // 0xeb: |====|==|  |==|  |==|==|==|
			4.20,  // 0xec: |    |  |==|==|  |==|==|==|
			6.18,  // 0xed: |====|  |==|==|  |==|==|==|
			4.70,  // 0xee: |    |==|==|==|  |==|==|==|
			6.50,  // 0xef: |====|==|==|==|  |==|==|==|
			2.53,  // 0xf0: |    |  |  |  |==|==|==|==|
			3.82,  // 0xf1: |====|  |  |  |==|==|==|==|
			3.65,  // 0xf2: |    |==|  |  |==|==|==|==|
			5.85,  // 0xf3: |====|==|  |  |==|==|==|==|
			3.73,  // 0xf4: |    |  |==|  |==|==|==|==|
			5.78,  // 0xf5: |====|  |==|  |==|==|==|==|
			5.70,  // 0xf6: |    |==|==|  |==|==|==|==|
			7.00,  // 0xf7: |====|==|==|  |==|==|==|==|
			2.90,  // 0xf8: |    |  |  |==|==|==|==|==|
			5.75,  // 0xf9: |====|  |  |==|==|==|==|==|
			6.10,  // 0xfa: |    |==|  |==|==|==|==|==|
			6.95,  // 0xfb: |====|==|  |==|==|==|==|==|
			4.90,  // 0xfc: |    |  |==|==|==|==|==|==|
			6.80,  // 0xfd: |====|  |==|==|==|==|==|==|
			4.09,  // 0xfe: |    |==|==|==|==|==|==|==|
			4.49,  // 0xff: |====|==|==|==|==|==|==|==|
	};
}
